<Project>
  <UsingTask AssemblyFile="$(OutputPath)Bootstrap.dll" TaskName="Xamarin.Android.Lite.Bootstrap.DownloadUri" />
  <UsingTask AssemblyFile="$(OutputPath)Bootstrap.dll" TaskName="Xamarin.Android.Lite.Bootstrap.Unzip" />
  <Target Name="Bootstrap" DependsOnTargets="Build;SetProperties;Download;Unzip">
  </Target>
  <Target Name="SetProperties">
    <PropertyGroup>
      <!--Should be latest on 15.8 https://jenkins.mono-project.com/view/Xamarin.Android/job/xamarin-android/1082/Azure/-->
      <XamarinAndroidUrl>https://xamjenkinsartifact.blob.core.windows.net/xamarin-android/xamarin-android/xamarin.android-oss_v8.4.99.60_Darwin-x86_64_HEAD_6ce26a0d.zip</XamarinAndroidUrl>
      <UrlFile>$(IntermediateOutputPath)xamarin-android.url</UrlFile>
      <ZipFile>$(IntermediateOutputPath)xamarin-android.zip</ZipFile>
      <UnzipStamp>$(IntermediateOutputPath)xamarin-android.unzip.stamp</UnzipStamp>
    </PropertyGroup>
    <WriteLinesToFile
      File="$(UrlFile)"
      Lines="$(XamarinAndroidUrl)"
      Overwrite="True"
      WriteOnlyWhenDifferent="True"
    />
    <ItemGroup>
      <FileWrites Include="$(UrlFile)" />
    </ItemGroup>
  </Target>
  <Target Name="Download" Inputs="$(UrlFile)" Outputs="$(ZipFile)">
    <DownloadUri
      SourceUris="$(XamarinAndroidUrl)"
      DestinationFiles="$(ZipFile)"
    />
    <ItemGroup>
      <FileWrites Include="$(ZipFile)" />
    </ItemGroup>
  </Target>
  <Target Name="Unzip" Inputs="$(ZipFile)" Outputs="$(UnzipStamp)">
    <RemoveDir
      Directories="$(OutputPath)xamarin-android"
    />
    <Unzip
      SourceFiles="$(ZipFile)"
      DestinationFolder="$(OutputPath)xamarin-android"
      SkipTopDirectory="True"
      OverwriteReadonlyFiles="True"
      SkipUnchangedFiles="True"
    />
    <Touch
      Files="$(UnzipStamp)"
      AlwaysCreate="True"
    />
    <ItemGroup>
      <FileWrites Include="$(UnzipStamp)" />
    </ItemGroup>
  </Target>
</Project>